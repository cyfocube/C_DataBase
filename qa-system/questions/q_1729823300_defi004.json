{
  "id": "q_1729823300_defi004",
  "title": "Aave V3 flash loan callback reverts with \"Invalid flashloan executor\"",
  "content": "My flash loan contract keeps failing on Aave V3 Polygon. The flash loan initiates successfully but reverts in the callback. Here's my contract:\n\n```solidity\ncontract FlashLoanArbitrage is FlashLoanSimpleReceiverBase {\n    constructor(IPoolAddressesProvider _provider) FlashLoanSimpleReceiverBase(_provider) {}\n    \n    function executeOperation(\n        address asset,\n        uint256 amount,\n        uint256 premium,\n        address initiator,\n        bytes calldata params\n    ) external override returns (bool) {\n        require(msg.sender == address(POOL), \"Invalid caller\");\n        \n        // Arbitrage logic here\n        performArbitrage(asset, amount);\n        \n        // Approve the LendingPool contract allowance to *pull* the owed amount\n        uint256 amountOwed = amount + premium;\n        IERC20(asset).approve(address(POOL), amountOwed);\n        \n        return true;\n    }\n    \n    function startFlashLoan(address asset, uint256 amount) external onlyOwner {\n        POOL.flashLoanSimple(address(this), asset, amount, \"\", 0);\n    }\n}\n```\n\nError: `\"Errors.INVALID_FLASHLOAN_EXECUTOR_RETURN\"`. I've verified:\n- Contract has enough tokens to repay + premium\n- POOL address is correct (0x794a61358D6845594F94dc1DB02A252b5b4814aD)\n- Approval works (checked allowance after)\n\nWhat am I doing wrong? This worked fine on Aave V2.",
  "tags": ["aave", "flashloan", "polygon", "defi", "smart-contracts", "arbitrage"],
  "difficulty": "Intermediate",
  "bounty_amount": 150,
  "bounty_token": "USDC",
  "author_wallet": "0x0123456789012345678901234567890123456789",
  "author_name": "FlashLoanDev",
  "created_at": "2025-10-24T11:15:00Z",
  "updated_at": "2025-10-24T11:15:00Z",
  "views": 203,
  "votes": 16,
  "answer_count": 4,
  "is_answered": true,
  "accepted_answer_id": "a_1729823700_defi004",
  "last_activity": "2025-10-24T15:10:00Z"
}